// Created 9/26/2013 8:30:02 PM
var SINGLE_CLICK="singleClick",DOUBLE_CLICK="doubleClick",WAIT_FOR_DOUBLE_CLICK_TIMEOUT=250,MS_CLICKED_ONCE="clickedOnce";
function setClickEvents(a,b,c){function d(a,b,d){b.changedTouches&&(b=b.changedTouches[0]);a.initMouseEvent(d,!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,0,null)}c=c?c:!1;var e=!1,f=!1;if(!0===b||!1===b)k=b;else var k=b?-1!=b.indexOf("d"):!1,h=b?-1!=b.indexOf("m"):!1,e=b?-1!=b.indexOf("s"):!1,f=b?-1!=b.indexOf("p"):!1;a.ondblclick=function(a){a.preventDefault();return!1};var m=function(b){function r(){a.removeEventListener(n,E,c);a.removeEventListener(l,
v,c);a.removeEventListener("touchcancel",s)}var n;if(!(b.ctrlKey||b.altKey||b.shiftKey)){if("touchstart"==b.type){a.removeEventListener("mousedown",m,c);var l="touchend";n="touchmove"}else l="mouseup",n="mousemove",a.removeEventListener("touchstart",m,c);if(a.mstate==MS_CLICKED_ONCE){window.clearTimeout(a.resetClickTimeout);a.mstate="";var t=function(b){var h=Modernizr.touch?b.changedTouches[0]:b;30>Math.abs(h.clientX-a.positionObj.x)&&30>Math.abs(h.clientY-a.positionObj.y)&&(h=document.createEvent("MouseEvent"),
d(h,b,DOUBLE_CLICK),a.dispatchEvent(h));a.removeEventListener(l,t,c);r();f&&b.preventDefault();if(e)return b.stopPropagation(),!1};k&&a.addEventListener(l,t,c);f&&b.preventDefault()}else{var p=Modernizr.touch?b.touches[0]:b;a.positionObj={x:p.clientX,y:p.clientY};var v=function(b){a.removeEventListener(l,v,c);var h=document.createEvent("MouseEvent");d(h,b,SINGLE_CLICK);k?(a.mstate=MS_CLICKED_ONCE,a.resetClickTimeout=setTimeout(function(){a.dispatchEvent(h);r();a.mstate=""},WAIT_FOR_DOUBLE_CLICK_TIMEOUT)):
(a.dispatchEvent(h),r(),a.mstate="");if(e)return b.stopPropagation(),!1};a.addEventListener(l,v,c);a.addEventListener("touchcancel",s,!1);var s=function(){r();a.mstate=""};if(h){if(!Modernizr.touch)var u=b.clientX,w=b.clientY;var E=function(b){if(Modernizr.touch||u!=b.clientX||w!=b.clientY)r(),a.mstate=""};a.addEventListener(n,E,c)}}if(e)return b.stopPropagation(),!1}};a.addEventListener(DOWN_EVENT,m,c)}
function mouseHandler(a){var b="";switch(a.type){case "mousedown":b="touchstart";break;case "mousemove":b="touchmove";break;case "mouseup":b="touchend";break;default:return}var c=[{screenX:a.screenX,screenY:a.screenY,clientX:a.clientX,clientY:a.clientY}],d=document.createEvent("MouseEvent");d.initMouseEvent(b,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,1,null);d.simulated=!0;d.touches=c;d.targetTouches=c;d.changedTouches=c;a.target.dispatchEvent(d);a.preventDefault();a.stopPropagation();
return!1}function redirectGlobalEvents(){}
function testCrossEvents(){redirectGlobalEvents();setClickEvents(document.getElementById("test"),!1);setClickEvents(document.getElementById("Div2"),!0);document.getElementById("Div2").addEventListener(DOUBLE_CLICK,function(a){document.getElementById("log").innerHTML+="btn"+a.type+a.screenX+a.currentTarget.id+"<br>";return!1});document.getElementById("test").addEventListener(SINGLE_CLICK,function(a){document.getElementById("log").innerHTML+="div"+a.type+a.screenX+"<br>";return!1});document.getElementById("test").addEventListener("touchstart",
function(a){document.getElementById("log").innerHTML+="touch "+a.touches+"<br>";return!1})}
function initCrossEvents(){if(Modernizr){var a=Modernizr.touch;DOWN_EVENT=a?"touchstart":"mousedown";UP_EVENT=a?"touchend":"mouseup";MOVE_EVENT=a?"touchmove":"mousemove"}else console.log("Modernizr is undefined");window.fconsole=new FBConsole;window.showConsole=function(){window.fconsole.append()};for(a=0;a<document.head.getElementsByTagName("meta").length;a++){var b=document.head.getElementsByTagName("meta")[a];"viewport"==b.name&&fconsole.log(b.content)}fconsole.log("displayRatio:",window.devicePixelRatio)}
var browser={name:"",version:"",platform:"",publisher:"",scale:1,detect:function(){var a=navigator.userAgent.toLowerCase(),b=navigator.platform.toLowerCase(),c=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],d="ie"==c[1]&&document.documentMode;browser.name="version"==c[1]?c[3]:c[1];browser.version=d||parseFloat("opera"==c[1]&&c[4]?c[4]:c[2]);browser.platform={name:a.match(/ip(?:ad|od|hone)/)?"ios":a.match(/(?:msie 9)/)?"wphone":
(a.match(/(?:webos|android|bada|symbian|palm|blackberry)/)||b.match(/mac|win|linux/)||["other"])[0]};browser.device=a.match(/ipad/)?"iPad":a.match(/iphone/)?"iPhone":a.match(/android/)?"android":!1;browser.publisher={};try{browser.publisher.deviceName=preview.get_Type(),browser.publisher.orientation=preview.get_Orientation(),browser.publisher.isOn=!0}catch(e){}browser[browser.name]=!0;browser[browser.name+parseInt(browser.version,10)]=!0;browser.platform[browser.platform.name]=!0}};ADD_BM="addBm";
REMOVE_BM="removeBm";START_SEARCH="startSearch";CANCEL_SEARCH="cancelSearch";SHOW_SEARCH_RESULTS="showSearchResults";ZOOMIN_FROM_WORKSPACE="zoomInFromWorkspace";ZOOMOUT_FROM_WORKSPACE="zoomOutFromWorkspace";BOOK_FLIPPING_START="bookFlippingStart";BOOK_FLIPPING_END="bookFlippingEnd";CHANGE_BOOK_TYPE="changeBookType";SLIDER_TO_PAGER_CHANGE_LABEL="sliderToPagerChangeLabel";ROTATE_DEVICE="rotateDevice";DOUBLE_TAP_FROM_WORKSPACE="double_tap_from_workspace";IOS_LOAD_PAGE_START="iOSLoadPageStart";
IOS_LOAD_VECTOR_END="iOSLoadVectorEnd";IOS_LOAD_BITMAP_END="iOSLoadBitmapEnd";IOS_FULLSCREEN="iOSFullScreen";ANDROID_PAGE_CONTENT_LOAD_COMPLETE="ANDROID_PAGE_CONTENT_LOAD_COMPLETE";ANDROID_PAGE_PREPARED="ANDROID_PAGE_PREPARED";ZOOM_ANIMATION_START="zoom_animation_start";ZOOM_ANIMATION_END="zoom_animation_end";ZOOM_ANIMATION_END_TO_ONE="zoom_animation_end_to_one";ZOOM_ANIMATION_END_TO_TWO="zoom_animation_end_to_two";ZOOM_ZOOM_ANIMATION_END="ZOOM_ZOOM_ANIMATION_END";START_ZOOM_PRELOADER="startZoomPreloader";
STOP_ZOOM_PRELOADER="stopZoomPreloader";ZOOM_LEVEL_CHANGED_FOR_WORKSPACE="zoom_level_changed_for_workspace";SEND_STATISTICS="send_statistics";PAGE_CONTENT_DISPLAYED="page_content_displayed";function CustomEvents(){this._listeners={}}
CustomEvents.prototype={addEvent:function(a){throw Error("obsolete function");},removeEvent:function(a){throw Error("obsolete function");},addListener:function(a,b){void 0==this._listeners[a]&&(this._listeners[a]=[]);this._listeners[a].push(b);return!0},removeListener:function(a,b){if(void 0==this._listeners[a])return!1;var c=this._listeners[a].indexOf(b);if(-1!=c)this._listeners[a].splice(c,1);else return!1;return!0},fireEvent:function(a,b){if(void 0!=this._listeners[a])for(var c=0,d=this._listeners[a].length;c<
d;c++)void 0!=this._listeners[a][c]&&this._listeners[a][c].call(this,{type:a,data:b})}};customEvents=new CustomEvents;
var sendPage=function(){var a=window.location.hash.replace("#",""),b=window.location.hostname+window.location.pathname;GAEnable&&PUBL&&_trackPageview(b+"-"+pageTable.getUserIDFromFileID(a))},sendZoomIn=function(){var a=window.location.hash.replace("#",""),b=window.location.hostname+window.location.pathname;sendPage();GAEnable&&PUBL&&_trackEvent(b+"","Zooming","page"+a)},sendZoomOut=function(){var a=window.location.hash.replace("#",""),b=window.location.hostname+window.location.pathname;sendPage();
GAEnable&&PUBL&&_trackEvent(b+"","Zooming out","page"+a)};customEvents.addListener(BOOK_FLIPPING_END,sendPage);customEvents.addListener(ZOOM_ANIMATION_END,sendZoomIn);customEvents.addListener(ZOOM_ANIMATION_END_TO_ONE,sendZoomOut);customEvents.addListener(ZOOM_ANIMATION_END_TO_TWO,sendZoomOut);customEvents.addListener(ANDROID_PAGE_PREPARED,sendPage);customEvents.addListener(ZOOMIN_FROM_WORKSPACE,sendZoomIn);customEvents.addListener(ZOOMOUT_FROM_WORKSPACE,sendZoomOut);
customEvents.addListener(DOUBLE_TAP_FROM_WORKSPACE,sendZoomIn);
var device={width:function(){return window.innerWidth},height:function(){return"iPhone"==this.name()?416==window.innerHeight&&"portrait"==orientationObserver.getOrientation()?window.innerHeight:416>window.innerHeight&&"portrait"==orientationObserver.getOrientation()?window.innerHeight+60:250<window.innerHeight&&"landscape"==orientationObserver.getOrientation()?window.innerHeight:250>window.innerHeight&&"landscape"==orientationObserver.getOrientation()?window.innerHeight+60:window.innerHeight:window.innerHeight},
proportions:function(){return(this.width()/this.height()).toFixed(2)},name:function(){var a="other",a=browser.platform.ios&&"iPad"===browser.device?"iPad":"iPhone",a=!0==browser.platform.android?"android":a,a=!0==browser.platform.wphone?"wphone":a;return browser.publisher.isOn?browser.publisher.device:a}};function createDiv(a,b){var c=document.createElement("div");c.setAttribute("id",a);c.style.position="absolute";b&&(c.style.overflow="hidden");return c}var FCONSOLE_MAX_ROWS=33,LINE_BR="<br />";
function FBConsole(){function a(a){for(var b="",c=0;c<a.length;c++){switch(typeof a[c]){case "number":b+=d(a[c].toString(),"blue");break;default:b+=a[c]}c<a.length-1&&(b+=" ")}return b}function b(){c.innerHTML=k+(h?"":LINE_BR+LINE_BR+f)}var c=createDiv("fconsole"),d=function(a,b){return'<font color="'+b+'">'+a+"</font>"};c.style.left="0px";c.style.top="100px";c.style.width="100";c.style.height="100";c.style.opacity="0.7";c.style.backgroundColor="#e0efee";c.style.color="#11111f";c.style.fontSize="14px";
c.style.zIndex=100;c.style.webkitTransform="translate3d(0px,0px,500px)";c.addEventListener(UP_EVENT,function(a){h?(h=!1,b()):(f=[],b(),h=!0)},!1);var e=[],f=[],k="",h,m=!1;this.append=function(){m=!0;document.body.appendChild(c);b()};this.update=function(a,c){for(var h,f=0;f<e.length;f++)e[f].name==a&&(h=e[f]);"number"==typeof c&&(c=c.toString());h?h.value=c:e.push({name:a,value:c});k="";for(f=0;f<e.length;f++)k+=d(e[f].name,"green")+": "+d(e[f].value,"blue")+(f==e.length-1?"":LINE_BR);m&&b()};this.log=
function(c){f.length>FCONSOLE_MAX_ROWS-1&&f.shift();var d=a(arguments);f.push(d+LINE_BR);m&&b()};this.logAdd=function(c){var d=a(arguments);f[f.length-1]+=" "+d;m&&b()}}function HighlightItem(a,b,c,d){var e="R"==a[1],f,k,h;e?(f=a[2]/10,k=a[3]/10,h=a[4]/1E3,a=a[5]/10):(f=a[1]/10,k=a[2]/10,h=a[3]/1E3,a=a[4]/10);var m=0===c?0:b[c-1]/10;b=b[c+(d-1)]/10-m;this.y=k;this.x=f+m-(e?b:0);this.width=b;this.height=a;this.angle=h}
var highlight={getFillStyle:function(){return"rgba("+fbUtils.hexToRGB(publicationData.search.color)+",0.4)"},active:!1,init:function(){var a=this;customEvents.addListener(SHOW_SEARCH_RESULTS,function(){a.show()});customEvents.addListener(CANCEL_SEARCH,function(){a.hide()})},show:function(a,b){a=a||-10;search.active&&search.pages[a]&&(-10==a&&(a=pageMediator.page),b=b||el.id("highlightCanvas"+a),this.process(function(){highlight.light.apply(this,arguments)},a,b),this.active=!0);publicationData.page[a].videos&&
video.inject(b,a)},hide:function(a,b){a=a||-10;-10==a?this.active=!1:this.claerPage(a,b);search.stop()},claerPage:function(a,b){b=b||el.id("highlightCanvas"+a);b.getContext("2d").clearRect(0,0,b.width,b.height);this.active=!1},process:function(a,b,c,d){c&&this.claerPage(b,c);var e=function(){for(var f=this.responseText.split("\n"),h=search.query.toLowerCase()||"",h=fbUtils.split(h,0),e=1;e<f.length;e++){word=f[e];for(var q=0,r=0;r<h.length;r++){var n=h[r],l=word.split(String.fromCharCode(2));if(n.length<
publicationData.search.lim){var t=void 0!=f[e-1]?f[e-1].split(String.fromCharCode(2))[0]:"",q=f[e].split(String.fromCharCode(2))[0]||"",p=void 0!=f[e+1]?f[e+1].split(String.fromCharCode(2))[0]:"",t=t+" "+q,q=q+" "+p,p=h[r-1]||"",v=h[r],s=h[r+1]||"",u=p+" "+v,w=v+" "+s,v=!1;""!=p&&-1!=t.toLowerCase().indexOf(u)&&(v=!0);""!=s&&-1!=q.toLowerCase().indexOf(w)&&(v=!0)}else v=!0;if(-1!=(q=l[0].toLowerCase().indexOf(n))&&v)if(p=word.split(String.fromCharCode(4)),1<p.length){l=[];t=[];for(s=0;s<p.length;s++)l[s]=
p[s].split(String.fromCharCode(2)),0<s&&l[s].unshift(l[0][0]),t[s]=l[s][5].split(String.fromCharCode(3));p=q;n=q+n.length;for(q=0;q<l.length;q++)t[q].length<=p?(p-=t[q].length,n-=t[q].length):(n>t[q].length?(s=t[q].length,n-=t[q].length):(s=n,n=0),0<p&&(s-=p),s=new HighlightItem(l[q],t[q],p,s),p=0,a(s,c,b))}else t="R"==l[1]?l[6].split(String.fromCharCode(3)):l[5].split(String.fromCharCode(3)),s=new HighlightItem(l,t,q,n.length),a(s,c,b)}}d&&d()};if(PUBL)publ.getData(ASSETS_FOLDER+"/search/search"+
fbUtils.getNum(b)+".xml",e);else{var f=new XMLHttpRequest;f.open("GET",ASSETS_FOLDER+"/search/search"+fbUtils.getNum(b)+".xml");f.onload=e;f.onerror=function(){};f.send();delete f}},light:function(a,b,c){var d=b.getContext("2d");d.fillStyle=window.highlight.getFillStyle();b=b.width/(publicationData.page[c].width||publicationData.page.defaults.width);c=a.x;var e=a.y,f=a.width,k=a.height;d.save();d.scale(b,b);d.translate(c,e);d.rotate(a.angle);d.clearRect(0,0,f,k);d.fillRect(0,0,f,k);d.restore();delete null},
getHighlights:function(a,b){var c=[];this.process(function(a){c.push(a)},a,null,function(){b(c)})}},HTML5lib={init:function(){switch(system.browser.name){case "safari":this.browserPrefix="webkit";break;case "firefox":this.browserPrefix="Moz";break;case "opera":this.browserPrefix="O";break;case "ie":this.browserPrefix="ms";break;case "chrome":this.browserPrefix="webkit"}},translate:function(a,b,c,d){b=b||0;c=c||0;a.style[this.browserPrefix+"Transform"]=Modernizr.csstransforms3d?"translate3d("+b+"px,"+
c+"px,"+(d||0)+"px)":"translate("+b+"px,"+c+"px)"},duration:function(a,b){a.style[this.browserPrefix+"TransitionDuration"]=b+"ms"},perspective:function(a,b){a.style[this.browserPrefix+"Transform"]="perspective("+b+")"},scale:function(a,b,c){a=a||0;b=b||0;el.style[this.browserPrefix+"Transform"]=Modernizr.csstransforms3d?"scale3d("+a+","+b+","+(c||0)+")":"scale("+a+","+b+")"},rotate:function(a,b,c,d,e){c=c||0;a.style[this.browserPrefix+"Transform"]=Modernizr.csstransforms3d?"rotate3d("+c+","+c+","+
c+","+b+"deg)":"rotate("+b+"deg)"},backfaceVisibility:function(a,b){a.style[this.browserPrefix+"BackfaceVisibility"]=b},boxShadow:function(a,b){a.style[this.browserPrefix+"BoxShadow"]=b},getTransform:function(a){return a.style[this.browserPrefix+"Transform"]},transform:function(a,b,c){a.style[this.browserPrefix+"TransformOrigin"]="0px 0px";a.style[this.browserPrefix+"Transform"]="translate3d("+b+"px,"+c+"px,0px)"},getParseTranslate:function(a){a=a.style[this.browserPrefix+"Transform"].match(/-*\d+(?=px)|\d+\%/ig);
null==a&&(a=[0,0,0]);return{x:a[0],y:a[1],z:a[2]}},changeOnlyScale:function(a,b,c,d){re=/translate3d\([A-Za-z0-9_, ]*\)/i;var e=a.style[this.browserPrefix+"Transform"].match(re);null===e&&(e="");a.style[this.browserPrefix+"Transform"]=e+" scale3d("+b+","+c+","+d+")"}};
(function(a,b){function c(a){if(""===f)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return f+a}var d=Math,e=b.createElement("div").style,f=function(){for(var a=["t","webkitT","MozT","msT","OT"],g,b=0,c=a.length;b<c;b++)if(g=a[b]+"ransform",g in e)return a[b].substr(0,a[b].length-1);return!1}(),k=f?"-"+f.toLowerCase()+"-":"",h=c("transform"),m=c("transitionProperty"),q=c("transitionDuration"),r=c("transformOrigin"),n=c("transitionTimingFunction"),l=c("transitionDelay"),t=/android/gi.test(navigator.appVersion),
p=/iphone|ipad/gi.test(navigator.appVersion),v=/hp-tablet/gi.test(navigator.appVersion),s=c("perspective")in e,u="ontouchstart"in a&&!v,w=!!f,E=c("transition")in e,F="onorientationchange"in a?"orientationchange":"resize",G=u?"touchstart":"mousedown",B=u?"touchmove":"mousemove",C=u?"touchend":"mouseup",D=u?"touchcancel":"mouseup",I="Moz"==f?"DOMMouseScroll":"mousewheel",A=!1===f?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}[f],K=function(){return a.requestAnimationFrame||
a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),J=a.cancelRequestAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout,z=s?" translateZ(0)":"",v=function(H,g){var c=this,d;c.wrapper="object"==typeof H?H:b.getElementById(H);c.wrapper.style.overflow="hidden";
c.scroller=c.wrapper.children[0];c.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:t,hideScrollbar:p,fadeScrollbar:p&&s,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,
onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(d in g)c.options[d]=g[d];c.x=c.options.x;c.y=c.options.y;c.options.useTransform=w&&c.options.useTransform;c.options.hScrollbar=c.options.hScroll&&c.options.hScrollbar;c.options.vScrollbar=c.options.vScroll&&c.options.vScrollbar;c.options.zoom=c.options.useTransform&&c.options.zoom;c.options.useTransition=E&&c.options.useTransition;c.options.zoom&&t&&(z="");c.scroller.style[m]=
c.options.useTransform?k+"transform":"top left";c.scroller.style[q]="0";c.scroller.style[r]="0 0";c.options.useTransition&&(c.scroller.style[n]="cubic-bezier(0.33,0.66,0.66,1)");c.options.useTransform?c.scroller.style[h]="translate("+c.x+"px,"+c.y+"px)"+z:c.scroller.style.cssText+=";position:absolute;top:"+c.y+"px;left:"+c.x+"px";c.options.useTransition&&(c.options.fixedScrollbar=!0);c.refresh();c._bind(F,a);c._bind(G);u||"none"!=c.options.wheelAction&&c._bind(I);c.options.checkDOMChanges&&(c.checkDOMTime=
setInterval(function(){c._checkDOMChanges()},500))};v.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case G:if(!u&&0!==a.button)break;this._start(a);break;case B:this._move(a);break;case C:case D:this._end(a);break;case F:this._resize();break;case I:this._wheel(a);break;case A:this._transitionEnd(a)}},_checkDOMChanges:function(){this.moved||this.zoomed||this.animating||this.scrollerW==
this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale||this.refresh()},_scrollbar:function(a){var g;this[a+"Scrollbar"]?(this[a+"ScrollbarWrapper"]||(g=b.createElement("div"),this.options.scrollbarClass?g.className=this.options.scrollbarClass+a.toUpperCase():g.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px"),g.style.cssText+=
";pointer-events:none;"+k+"transition-property:opacity;"+k+"transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1"),this.wrapper.appendChild(g),this[a+"ScrollbarWrapper"]=g,g=b.createElement("div"),this.options.scrollbarClass||(g.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+k+"background-clip:padding-box;"+k+"box-sizing:border-box;"+("h"==a?"height:100%":"width:100%")+
";"+k+"border-radius:3px;border-radius:3px"),g.style.cssText+=";pointer-events:none;"+k+"transition-property:"+k+"transform;"+k+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+k+"transition-duration:0;"+k+"transform: translate(0,0)"+z,this.options.useTransition&&(g.style.cssText+=";"+k+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),this[a+"ScrollbarWrapper"].appendChild(g),this[a+"ScrollbarIndicator"]=g),"h"==a?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,this.hScrollbarIndicatorSize=
d.max(d.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=d.max(d.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=this.vScrollbarIndicatorSize+
"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY),this._scrollbarPos(a,!0)):this[a+"ScrollbarWrapper"]&&(w&&(this[a+"ScrollbarIndicator"].style[h]=""),this[a+"ScrollbarWrapper"].parentNode.removeChild(this[a+"ScrollbarWrapper"]),this[a+"ScrollbarWrapper"]=null,this[a+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},t?200:0)},_pos:function(a,g){this.zoomed||(a=this.hScroll?
a:0,g=this.vScroll?g:0,this.options.useTransform?this.scroller.style[h]="translate("+a+"px,"+g+"px) scale("+this.scale+")"+z:(a=d.round(a),g=d.round(g),this.scroller.style.left=a+"px",this.scroller.style.top=g+"px"),this.x=a,this.y=g,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(a,g){var b="h"==a?this.x:this.y;this[a+"Scrollbar"]&&(b*=this[a+"ScrollbarProp"],0>b?(this.options.fixedScrollbar||(b=this[a+"ScrollbarIndicatorSize"]+d.round(3*b),8>b&&(b=8),this[a+"ScrollbarIndicator"].style["h"==
a?"width":"height"]=b+"px"),b=0):b>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?b=this[a+"ScrollbarMaxScroll"]:(b=this[a+"ScrollbarIndicatorSize"]-d.round(3*(b-this[a+"ScrollbarMaxScroll"])),8>b&&(b=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=b+"px",b=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-b))),this[a+"ScrollbarWrapper"].style[l]="0",this[a+"ScrollbarWrapper"].style.opacity=g&&this.options.hideScrollbar?"0":"1",this[a+"ScrollbarIndicator"].style[h]=
"translate("+("h"==a?b+"px,0)":"0,"+b+"px)")+z)},_start:function(b){var g=u?b.touches[0]:b,c,f;this.enabled&&(this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,b),(this.options.useTransition||this.options.zoom)&&this._transitionTime(0),this.zoomed=this.animating=this.moved=!1,this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0,this.options.zoom&&u&&1<b.touches.length&&(f=d.abs(b.touches[0].pageX-b.touches[1].pageX),c=d.abs(b.touches[0].pageY-b.touches[1].pageY),
this.touchesDistStart=d.sqrt(f*f+c*c),this.originX=d.abs(b.touches[0].pageX+b.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=d.abs(b.touches[0].pageY+b.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,b)),this.options.momentum&&(this.options.useTransform?(c=getComputedStyle(this.scroller,null)[h].replace(/[^0-9\-.,]/g,"").split(","),f=1*c[4],c=1*c[5]):(f=1*getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,
""),c=1*getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),f!=this.x||c!=this.y)&&(this.options.useTransition?this._unbind(A):J(this.aniTime),this.steps=[],this._pos(f,c)),this.absStartX=this.x,this.absStartY=this.y,this.startX=this.x,this.startY=this.y,this.pointX=g.pageX,this.pointY=g.pageY,this.startTime=b.timeStamp||Date.now(),this.options.onScrollStart&&this.options.onScrollStart.call(this,b),this._bind(B,a),this._bind(C,a),this._bind(D,a))},_move:function(a){var b=u?a.touches[0]:
a,c=b.pageX-this.pointX,f=b.pageY-this.pointY,e=this.x+c,k=this.y+f,l=a.timeStamp||Date.now();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,a);if(this.options.zoom&&u&&1<a.touches.length)e=d.abs(a.touches[0].pageX-a.touches[1].pageX),k=d.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDist=d.sqrt(e*e+k*k),this.zoomed=!0,b=1/this.touchesDistStart*this.touchesDist*this.scale,b<this.options.zoomMin?b=0.5*this.options.zoomMin*Math.pow(2,b/this.options.zoomMin):b>this.options.zoomMax&&
(b=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/b)),this.lastScale=b/this.scale,e=this.originX-this.originX*this.lastScale+this.x,k=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[h]="translate("+e+"px,"+k+"px) scale("+b+")"+z,this.options.onZoom&&this.options.onZoom.call(this,a);else{this.pointX=b.pageX;this.pointY=b.pageY;if(0<e||e<this.maxScrollX)e=this.options.bounce?this.x+c/2:0<=e||0<=this.maxScrollX?0:this.maxScrollX;if(k>this.minScrollY||k<this.maxScrollY)k=
this.options.bounce?this.y+f/2:k>=this.minScrollY||0<=this.maxScrollY?this.minScrollY:this.maxScrollY;this.distX+=c;this.distY+=f;this.absDistX=d.abs(this.distX);this.absDistY=d.abs(this.distY);6>this.absDistX&&6>this.absDistY||(this.options.lockDirection&&(this.absDistX>this.absDistY+5?(k=this.y,f=0):this.absDistY>this.absDistX+5&&(e=this.x,c=0)),this.moved=!0,this._pos(e,k),this.dirX=0<c?-1:0>c?1:0,this.dirY=0<f?-1:0>f?1:0,300<l-this.startTime&&(this.startTime=l,this.startX=this.x,this.startY=this.y),
this.options.onScrollMove&&this.options.onScrollMove.call(this,a))}},_end:function(c){if(!u||0===c.touches.length){var g=this,f=u?c.changedTouches[0]:c,e,k,l={dist:0,time:0},m={dist:0,time:0},p=(c.timeStamp||Date.now())-g.startTime,n=g.x,r=g.y;g._unbind(B,a);g._unbind(C,a);g._unbind(D,a);g.options.onBeforeScrollEnd&&g.options.onBeforeScrollEnd.call(g,c);if(g.zoomed)n=g.scale*g.lastScale,n=Math.max(g.options.zoomMin,n),n=Math.min(g.options.zoomMax,n),g.lastScale=n/g.scale,g.scale=n,g.x=g.originX-g.originX*
g.lastScale+g.x,g.y=g.originY-g.originY*g.lastScale+g.y,g.scroller.style[q]="200ms",g.scroller.style[h]="translate("+g.x+"px,"+g.y+"px) scale("+g.scale+")"+z,g.zoomed=!1,g.refresh(),g.options.onZoomEnd&&g.options.onZoomEnd.call(g,c);else{if(g.moved){if(300>p&&g.options.momentum){l=n?g._momentum(n-g.startX,p,-g.x,g.scrollerW-g.wrapperW+g.x,g.options.bounce?g.wrapperW:0):l;m=r?g._momentum(r-g.startY,p,-g.y,0>g.maxScrollY?g.scrollerH-g.wrapperH+g.y-g.minScrollY:0,g.options.bounce?g.wrapperH:0):m;n=g.x+
l.dist;r=g.y+m.dist;if(0<g.x&&0<n||g.x<g.maxScrollX&&n<g.maxScrollX)l={dist:0,time:0};if(g.y>g.minScrollY&&r>g.minScrollY||g.y<g.maxScrollY&&r<g.maxScrollY)m={dist:0,time:0}}l.dist||m.dist?(l=d.max(d.max(l.time,m.time),10),g.options.snap&&(m=n-g.absStartX,p=r-g.absStartY,d.abs(m)<g.options.snapThreshold&&d.abs(p)<g.options.snapThreshold?g.scrollTo(g.absStartX,g.absStartY,200):(m=g._snap(n,r),n=m.x,r=m.y,l=d.max(m.time,l))),g.scrollTo(d.round(n),d.round(r),l)):g.options.snap?(m=n-g.absStartX,p=r-g.absStartY,
d.abs(m)<g.options.snapThreshold&&d.abs(p)<g.options.snapThreshold?g.scrollTo(g.absStartX,g.absStartY,200):(m=g._snap(g.x,g.y),m.x==g.x&&m.y==g.y||g.scrollTo(m.x,m.y,m.time))):g._resetPos(200)}else u&&(g.doubleTapTimer&&g.options.zoom?(clearTimeout(g.doubleTapTimer),g.doubleTapTimer=null,g.options.onZoomStart&&g.options.onZoomStart.call(g,c),g.zoom(g.pointX,g.pointY,1==g.scale?g.options.doubleTapZoom:1),g.options.onZoomEnd&&setTimeout(function(){g.options.onZoomEnd.call(g,c)},200)):this.options.handleClick&&
(g.doubleTapTimer=setTimeout(function(){g.doubleTapTimer=null;for(e=f.target;1!=e.nodeType;)e=e.parentNode;"SELECT"!=e.tagName&&"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName&&(k=b.createEvent("MouseEvents"),k.initMouseEvent("click",!0,!0,c.view,1,f.screenX,f.screenY,f.clientX,f.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,0,null),k._fake=!0,e.dispatchEvent(k))},g.options.zoom?250:0))),g._resetPos(400);g.options.onTouchEnd&&g.options.onTouchEnd.call(g,c)}}},_resetPos:function(a){var b=0<=this.x?0:this.x<
this.maxScrollX?this.maxScrollX:this.x,c=this.y>=this.minScrollY||0<this.maxScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;b==this.x&&c==this.y?(this.moved&&(this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this)),this.hScrollbar&&this.options.hideScrollbar&&("webkit"==f&&(this.hScrollbarWrapper.style[l]="300ms"),this.hScrollbarWrapper.style.opacity="0"),this.vScrollbar&&this.options.hideScrollbar&&("webkit"==f&&(this.vScrollbarWrapper.style[l]="300ms"),
this.vScrollbarWrapper.style.opacity="0")):this.scrollTo(b,c,a||0)},_wheel:function(a){var b=this,c,d;if("wheelDeltaX"in a)c=a.wheelDeltaX/12,d=a.wheelDeltaY/12;else if("wheelDelta"in a)c=d=a.wheelDelta/12;else if("detail"in a)c=d=3*-a.detail;else return;"zoom"==b.options.wheelAction?(d=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0)),d<b.options.zoomMin&&(d=b.options.zoomMin),d>b.options.zoomMax&&(d=b.options.zoomMax),d!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,
a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))):(c=b.x+c,d=b.y+d,0<c?c=0:c<b.maxScrollX&&(c=b.maxScrollX),d>b.minScrollY?d=b.minScrollY:d<b.maxScrollY&&(d=b.maxScrollY),0>b.maxScrollY&&b.scrollTo(c,d,0))},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind(A),this._startAni())},_startAni:function(){var a=this,b=a.x,c=a.y,f=Date.now(),e,h,k;a.animating||(a.steps.length?
(e=a.steps.shift(),e.x==b&&e.y==c&&(e.time=0),a.animating=!0,a.moved=!0,a.options.useTransition?(a._transitionTime(e.time),a._pos(e.x,e.y),a.animating=!1,e.time?a._bind(A):a._resetPos(0)):(k=function(){var l=Date.now(),m;l>=f+e.time?(a._pos(e.x,e.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),a._startAni()):(l=(l-f)/e.time-1,h=d.sqrt(1-l*l),l=(e.x-b)*h+b,m=(e.y-c)*h+c,a._pos(l,m),a.animating&&(a.aniTime=K(k)))},k())):a._resetPos(400))},_transitionTime:function(a){a+=
"ms";this.scroller.style[q]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[q]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[q]=a)},_momentum:function(a,b,c,e,f){b=d.abs(a)/b;var h=b*b/0.0012;0<a&&h>c?(c+=f/(6/(6E-4*(h/b))),b=b*c/h,h=c):0>a&&h>e&&(e+=f/(6/(6E-4*(h/b))),b=b*e/h,h=e);return{dist:h*(0>a?-1:1),time:d.round(b/6E-4)}},_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,c*=this.scale);return{left:b,
top:c}},_snap:function(a,b){var c,e,f;f=this.pagesX.length-1;c=0;for(e=this.pagesX.length;c<e;c++)if(a>=this.pagesX[c]){f=c;break}f==this.currPageX&&0<f&&0>this.dirX&&f--;a=this.pagesX[f];e=(e=d.abs(a-this.pagesX[this.currPageX]))?500*(d.abs(this.x-a)/e):0;this.currPageX=f;f=this.pagesY.length-1;for(c=0;c<f;c++)if(b>=this.pagesY[c]){f=c;break}f==this.currPageY&&0<f&&0>this.dirY&&f--;b=this.pagesY[f];c=(c=d.abs(b-this.pagesY[this.currPageY]))?500*(d.abs(this.y-b)/c):0;this.currPageY=f;f=d.round(d.max(e,
c))||200;return{x:a,y:b,time:f}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){this.scroller.style[h]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(F,a);this._unbind(G);this._unbind(B,a);this._unbind(C,a);this._unbind(D,a);this.options.hasTouch||this._unbind(I);this.options.useTransition&&this._unbind(A);this.options.checkDOMChanges&&
clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,b,c,f=0;b=0;this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin);this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=d.round(this.scroller.offsetWidth*this.scale);this.scrollerH=d.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;
this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=
-a.top;if("string"==typeof this.options.snap)for(this.pagesX=[],this.pagesY=[],c=this.scroller.querySelectorAll(this.options.snap),a=0,b=c.length;a<b;a++)f=this._offset(c[a]),f.left+=this.wrapperOffsetLeft,f.top+=this.wrapperOffsetTop,this.pagesX[a]=f.left<this.maxScrollX?this.maxScrollX:f.left*this.scale,this.pagesY[a]=f.top<this.maxScrollY?this.maxScrollY:f.top*this.scale;else if(this.options.snap){for(this.pagesX=[];f>=this.maxScrollX;)this.pagesX[b]=f,f-=this.wrapperW,b++;this.maxScrollX%this.wrapperW&&
(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);b=f=0;for(this.pagesY=[];f>=this.maxScrollY;)this.pagesY[b]=f,f-=this.wrapperH,b++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");this._scrollbar("v");this.zoomed||(this.scroller.style[q]="0",this._resetPos(400))},scrollTo:function(a,b,c,f){var d=a;this.stop();
d.length||(d=[{x:a,y:b,time:c,relative:f}]);a=0;for(b=d.length;a<b;a++)d[a].relative&&(d[a].x=this.x-d[a].x,d[a].y=this.y-d[a].y),this.steps.push({x:d[a].x,y:d[a].y,time:d[a].time||0});this._startAni()},scrollToElement:function(a,b){var c;if(a=a.nodeType?a:this.scroller.querySelector(a))c=this._offset(a),c.left+=this.wrapperOffsetLeft,c.top+=this.wrapperOffsetTop,c.left=0<c.left?0:c.left<this.maxScrollX?this.maxScrollX:c.left,c.top=c.top>this.minScrollY?this.minScrollY:c.top<this.maxScrollY?this.maxScrollY:
c.top,b=void 0===b?d.max(2*d.abs(c.left),2*d.abs(c.top)):b,this.scrollTo(c.left,c.top,b)},scrollToPage:function(a,b,c){c=void 0===c?400:c;this.options.onScrollStart&&this.options.onScrollStart.call(this);this.options.snap?(a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b]):
(a*=-this.wrapperW,b*=-this.wrapperH,a<this.maxScrollX&&(a=this.maxScrollX),b<this.maxScrollY&&(b=this.maxScrollY));this.scrollTo(a,b,c)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(B,a);this._unbind(C,a);this._unbind(D,a)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(A):J(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,b,c,d){var f=c/this.scale;this.options.useTransform&&(this.zoomed=!0,d=void 0===
d?200:d,a=a-this.wrapperOffsetLeft-this.x,b=b-this.wrapperOffsetTop-this.y,this.x=a-a*f+this.x,this.y=b-b*f+this.y,this.scale=c,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[q]=d+"ms",this.scroller.style[h]="translate("+this.x+"px,"+this.y+"px) scale("+c+")"+z,this.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};e=null;"undefined"!==
typeof exports?exports.iScroll=v:a.iScroll=v})(window,document);
function LinksLayer(a,b){a.removeAllListeners&&a.removeAllListeners();this.canvas=a;this.rectStore="";this.videoLight=this.light=!1;this.activeLink={};var c=void 0==publicationData.page[b].videos?!1:!0;if(void 0!=publicationData.page[b].links||c){c=a.width/(publicationData.page[b].width||publicationData.page.defaults.width);this.links=[];this.links.active=!0;var d=0;for(i in publicationData.page[b].links){var e=publicationData.page[b].links[i];this.links[d]={};this.links[d].width=1*(e.width*c).toFixed(0);
this.links[d].height=1*(e.height*c).toFixed(0);this.links[d].x=1*(e.x*c).toFixed(0);this.links[d].y=1*(e.y*c).toFixed(0);this.links[d].page=e.page||-10;this.links[d].url=e.urls?e.urls[0]:-10;this.links[d].zIndex=e.zindex;this.links[d].videoType=!1;d++}for(i in publicationData.page[b].videos)e=publicationData.page[b].videos[i],this.links[d]={},this.links[d].width=1*(e.width*c).toFixed(0),this.links[d].height=1*(e.height*c).toFixed(0),this.links[d].x=1*(e.x*c).toFixed(0),this.links[d].y=1*(e.y*c).toFixed(0),
this.links[d].videoId=e.id,this.links[d].zIndex=e.zindex,this.links[d].videoType=e.type,d++;var f=this,k=function(b){var c,d;if(Modernizr.touch){var e=b.target.getBoundingClientRect();c=b.targetTouches[0].pageX-e.left;d=b.targetTouches[0].pageY-e.top;c*=a.width/e.width;d*=a.height/e.height}else c=b.offsetX,d=b.offsetY;for(li in f.links)if(e=f.links[li],c>=e.x&&c<=e.x+e.width&&d>=e.y&&d<=e.y+e.height){f.activeLink=e;e.videoType?f.videoLight=!0:(c=f.canvas.getContext("2d"),f.rectStore=c.getImageData(e.x-
2,e.y-2,e.width+4,e.height+4),f.light=!0,d=fbUtils.hexToRGB(publicationData.linkcolor||"#000000"),c.fillStyle="rgba("+d+",0.3)",c.fillRect(e.x,e.y,e.width,e.height));b.preventDefault();break}a.addEventListener(UP_EVENT,h);a.addEventListener(MOVE_EVENT,m)},h=function(b){a.removeEventListener(UP_EVENT,h);a.removeEventListener(MOVE_EVENT,m);f.light?(b=f.canvas.getContext("2d"),b.putImageData(f.rectStore,f.activeLink.x-2,f.activeLink.y-2),b=null,f.light=!1,-10!=f.activeLink.page?setTimeout(function(){pageMediator.goToPage(f.activeLink.page)},
1):-10!=f.activeLink.url&&(2==window.system.device.version&&window.system.platform.android?document.location.href=f.activeLink.url:f.activeLink.url.indexOf("mailto:")+1?window.open(f.activeLink.url,"_target"):window.open(f.activeLink.url,"_blank"))):f.videoLight&&(f.videoLight=!1,video.play(f.activeLink.videoType,f.activeLink.videoId,function(){},f.activeLink.width/f.activeLink.height))},m=function(b){a.removeEventListener(UP_EVENT,h);a.removeEventListener(MOVE_EVENT,m);f.light?(f.canvas.getContext("2d").putImageData(f.rectStore,
f.activeLink.x-2,f.activeLink.y-2),f.light=!1):f.videoLight&&(f.videoLight=!1)};a.addEventListener(DOWN_EVENT,k);a.removeAllListeners=function(){a.removeEventListener(DOWN_EVENT,k);a.removeEventListener(UP_EVENT,h);a.removeEventListener(MOVE_EVENT,m)};this.links.sort(function(a,b){return a.zIndex<b.zIndex?1:a.zIndex>b.zIndex?-1:0})}else this.links={},this.links.active=!1}ONLY_RASTER=!1;
function LoadManager(){function a(a){if(!a.waitingForImage&&!a.waitingForVector){if(a.onAllIsComplete)a.onAllIsComplete(a.image,a.vector);customEvents.fireEvent(ANDROID_PAGE_CONTENT_LOAD_COMPLETE,{page:a.position});c.length?e():d="standby"}}function b(b,c){void 0!=window.fakeLoadComplete&&fconsole.log("error on fakeLoadComplete");window.fakeLoadComplete=function(b){window.loadBuffers[b]=window.loadBuffer;c.waitingForVector=!1;if(c.onJSLoadComplete)c.onJSLoadComplete(window.loadBuffers[b]);c.vector=
window.loadBuffers[b];a(c);window.fakeLoadComplete=void 0};addScript(b)}var c=[],d="standby";window.loadBuffers=[];var e=function(){var a=c.shift();k(a)},f=[],k=function(h){function k(){h.image=p;h.waitingForImage=!1;if(h.onImageLoadComplete)h.onImageLoadComplete(p,t);a(h)}function q(){h.waitingForImage=!1;var b=p.src;if(void 0!=h.onPageLoadError)h.onPageLoadError(h.position);else fconsole.log("load error ",b);a(h)}if(publicationData.getPageProperty(h.position,"stub"))console.log("loadManager error: attempt to draw stub"),
c.length?e():d="standby";else{var r=h.quality,n=publicationData.getPageProperty(h.position,r?"zoomFormat":"format"),l=-1!=n.indexOf("jpg")?"jpg":"png",t=-1!=n.indexOf("js")&&!ONLY_RASTER,r=window.debugSVG_IMG?"content/current_"+h.position+".svg":t?COMMON_FOLDER+"/page-substrates/"+("page"+fill4Zero(h.position))+"."+l:ASSETS_FOLDER+"/pages/"+("page"+fill4Zero(h.position))+(r?"_i2.":"_i1.")+l,p=h.image||new Image;h.waitingForImage=!0;p.onload=k;p.onerror=q;(n=h.onImageStartLoading)&&n(p);if(t)if(n=
PUBL?void 0:PAGES_JS_FOLDER+"/"+("page"+fill4Zero(h.position))+".js",-1!=f.indexOf(h.position)){h.waitingForVector=!1;h.vector=window.loadBuffers[h.position];if(h.onJSLoadComplete)h.onJSLoadComplete(window.loadBuffers[h.position]);a(h)}else h.waitingForVector=!0,b(n,h);else h.waitingForVector=!1;changeUrlWhenPubl(r,function(a){p.src!=a&&p.src!=qualifyURL(a)?p.src=a:k()})}};this.addPageToQueue=function(a){c.push(a);"standby"==d?(d="loading",e()):a.skipCurrentLoading&&e()}}
function escapeHTML(a){return a.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")}function qualifyURL(a){var b=document.createElement("div");b.innerHTML='<a href="'+escapeHTML(a)+'">x</a>';return b.firstChild.href}function fill4Zero(a){return 1E3>a?Math.pow(10,4-a.toString().length).toString().slice(1)+a.toString():a.toString()}function addScript(a){var b=document.createElement("script");b.type="text/javascript";b.src=a;a=document.head;a.insertBefore(b,a.firstChild)}
PT_DOCUMENT="document";PT_PHOTOALBUM="photo_album";PT_CATALOG="catalog";PT_BOOK="book";PT_MAGAZINE="magazine";BOOK_FLIP_DURATION=0.5;PATH_TO_PROPERTIES=ASSETS_FOLDER+"/";ZOOM_LOCK=!1;
function initPageDisplayedEvent(){function a(){if(null!==e){for(var a=!0,b=0;b<e.length;b++)if(-1==d.indexOf(e[b])){a=!1;break}a&&(customEvents.fireEvent(PAGE_CONTENT_DISPLAYED,{pages:e}),e=null)}}function b(b){d.push(b.data.page);6<d.length&&(d=d.slice(-6));a()}function c(b){e=b.data.page;a()}var d=[],e=null;customEvents.addListener(ANDROID_PAGE_CONTENT_LOAD_COMPLETE,b);customEvents.addListener(ANDROID_PAGE_PREPARED,c);customEvents.addListener(BOOK_FLIPPING_END,c);customEvents.addListener(IOS_LOAD_BITMAP_END,
b)}
var main=function(){window.GAEnable||(GAEnable=!1);var a,b=function(){system.init();browser.detect();window.orientationObserver=new OrientationObserver;window.pageTable=new PageTable;HTML5lib.init();window.resources={};resources.MAIN_FRAME=el.id("mainFrame");publicationData.presentationMode=publicationData.type==PT_PHOTOALBUM||publicationData.type==PT_DOCUMENT;if(1<window.location.hash.length){publicationData.restoreSession=!1;var b=window.location.hash.substring(1,window.location.hash.length),d=
parseInt(b)}else d=1;d=pageTable.getFileIDFromUserID(d);void 0===d&&(d=1);pageMediator=new PageController(d,"single",publicationData.rtlMode);initCrossEvents();publicationData.collectStatistics=!1;if(publicationData.collectStatistics){b=document.createElement("script");with(b)type="text/javascript",onload=function(){stat.init()},src="http://static.publ.com/mobile/2.4.0/statisticsm.js";document.getElementsByTagName("head")[0].appendChild(b)}setClickEvents(resources.MAIN_FRAME,"dmp");2==window.devicePixelRatio&&
"ios"==system.platform.name&&(el.id("body").style.fontSize="16px");browser.publisher.isOn&&(el.id("body").style.fontSize="6px");window.WORKSPACE_ZOOM=system.platform.ios?1==window.IPADVER:!0;initSimpleUtils();initPageDisplayedEvent();workspace.init(resources.MAIN_FRAME,DEV);window.loadManager=new LoadManager;resources.BODY=document.body;publicationData.getPageProperty=function(a,b){var c=publicationData.page[a][b];return void 0==c?publicationData.page.defaults[b]:c};window.PAGES_JS_FOLDER=ASSETS_FOLDER+
"/pages/"+(system.platform.ios?"ios":"android");simpleLoadBook=function(){function b(c){a.setHighlight(c.type==SHOW_SEARCH_RESULTS);c.type==CANCEL_SEARCH&&search.stop()}function c(b){switch(b.type){case ZOOMIN_FROM_WORKSPACE:a.incZoom();break;case ZOOMOUT_FROM_WORKSPACE:a.decZoom()}}a=new SimpleViewer(resources.MAIN_FRAME);Math.min(innerWidth,innerHeight);(function(){var a=window.getComputedStyle(document.body,null).getPropertyValue("font-size");return parseFloat(a.substr(0,a.length-2))})();window.addEventListener("resize",
function(){a.resize()});a.set(d);customEvents.addListener(ZOOMIN_FROM_WORKSPACE,c);customEvents.addListener(ZOOMOUT_FROM_WORKSPACE,c);customEvents.addListener(SHOW_SEARCH_RESULTS,b);customEvents.addListener(CANCEL_SEARCH,b);DOUBLE_CLICK_TO_ZOOM&&customEvents.addListener(DOUBLE_TAP_FROM_WORKSPACE,function(b){a.handleDoubleClick(b.data)})};browser.publisher.isOn?"android"==browser.publisher.deviceName?simpleLoadBook():a="ipad"!=browser.publisher.deviceName||"landscape"!=browser.publisher.orientation||
publicationData.presentationMode?new IOSBook(d,1):new IOSBook(d,2):system.platform.ios?"ipad"===system.device.name?1==window.IPADVER?simpleLoadBook():a=new IOSBook(d):a=new IOSBook(d):simpleLoadBook();var e=function(){workspace.toolbars.isHide&&workspace.toolbars.toggle();e=null};customEvents.addListener(ZOOM_ANIMATION_END,e);customEvents.addListener(START_SEARCH,function(a){var b=function(){var b=eval("("+this.responseText+")");search.search(a.data.data,b.pages)};if(PUBL)publ.getData(ASSETS_FOLDER+
"/search/searchtext.js",b);else{var c=new XMLHttpRequest;c.open("GET",ASSETS_FOLDER+"/search/searchtext.js");c.onload=b;c.onerror=function(){document.write("Error: can`t load xml3")};c.send();delete c}});window.book=a;pageMediator.addListener(function(b){a.goToPage(b,BOOK_FLIP_DURATION);workspace.buttons.pageTurnHandler(b)})};localPending=function(){b()};iPadDetectPending=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.id="formPrinter";b.type="text/javascript";
b.src=LOCALS_FOLDER+"/"+publicationData.lang+"/textlang.js";a.appendChild(b)};"undefined"!==typeof window.ondevicemotion&&-1!=navigator.platform.indexOf("iPad")?window.ondevicemotion=function(a){-1!=navigator.platform.indexOf("iPad")&&(window.IPADVER=a.acceleration?2===window.devicePixelRatio?3:2:2,iPadDetectPending());window.ondevicemotion=null}:(window.IPADVER=0,iPadDetectPending());system.platform.ios&&browser.publisher.isOn&&(window.IPADVER=3);delete main};
window.PUBL?(PUBL=!0,PUBLDOMAIN=window.location):PUBL=!1;
window.getBookRectangle=function(a){HORIZONTAL_MARGIN=VERTICAL_MARGIN=10;a=publicationData.size.width*(a?2:1)/publicationData.size.height;window.innerWidth/window.innerHeight>a?(bookHeight=window.innerHeight-2*VERTICAL_MARGIN,bookWidth=bookHeight*a,bookLeft=(window.innerWidth-bookWidth)/2,bookTop=VERTICAL_MARGIN):(bookWidth=window.innerWidth-2*HORIZONTAL_MARGIN,bookHeight=bookWidth/a,bookLeft=HORIZONTAL_MARGIN,bookTop=(window.innerHeight-bookHeight)/2);return{width:1*bookWidth.toFixed(0),height:1*
bookHeight.toFixed(0),top:1*bookTop.toFixed(0),left:1*bookLeft.toFixed(0)}};
function OrientationObserver(){that=this;this.zoom=!1;var a="onorientationchange"in window;this.prevWidth=window.innerWidth;this.prevHeight=window.innerHeight;this.getOrientation=function(){browser.publisher.isOn&&console.log(browser.publisher.orientation);if(window.innerWidth>window.innerHeight)return"landscape";if(window.innerWidth<window.innerHeight)return"portrait"};this.rotateDevice=function(){setTimeout(b,100)};this.getType=function(a){return"photo_album"==publicationData.type||"document"==
publicationData.type||publicationData.singlePageMode||"ipad"!==system.device.name||1==window.IPADVER||"landscape"!==that.getOrientation()?"photo_album"!=publicationData.type&&"document"!=publicationData.type&&!publicationData.singlePageMode&&browser.publisher.isOn&&"ipad"===system.device.name&&1!=window.IPADVER&&window.innerWidth>window.innerHeight?that.typeBook=2:that.typeBook=1:that.typeBook=2};this.getType();var b=function(){that.prevWidth=window.innerWidth;that.prevHeight=window.innerHeight;that.getType();
customEvents.fireEvent(ROTATE_DEVICE,that.typeBook);iOS7LandscapeHeightBugFix()},c=function(){browser.publisher.isOn?b():that.prevHeight>that.prevWidth&&window.innerWidth>=that.prevHeight?b():that.prevHeight<that.prevWidth&&window.innerWidth>=that.prevHeight&&window.innerWidth!=that.prevWidth&&b()};a&&!PUBL?window.addEventListener("orientationchange",b):browser.publisher.isOn||window.addEventListener("resize",c);if(system.device.iphone&&"7"!==system.device.version&&!browser.publisher.isOn){var d=
function(){var a={};that.prevHeight!=window.innerHeight&&that.prevWidth==window.innerWidth?(that.getType(),customEvents.fireEvent(ROTATE_DEVICE,that.typeBook),a=window.innerHeight>that.prevHeight||520==window.innerHeight?{state:"in",by:"buttonPress"}:{state:"out",by:"buttonPress"}):a=that.prevWidth==window.innerHeight?{state:"in",by:"rotation"}:window.innerHeight>window.innerWidth&&system.browser.fullscreen?{state:"out",by:"rotation"}:!1;a&&(customEvents.fireEvent(IOS_FULLSCREEN,a),system.browser.fullscreen=
"in"==a.state?!0:!1);that.prevWidth=window.innerWidth;that.prevHeight=window.innerHeight};window.addEventListener("resize",d);customEvents.addListener(ADD_BM,function(){system.browser.fullscreen&&d()})}customEvents.addListener(CHANGE_BOOK_TYPE,function(a){that.zoom=3==a.data.type?!0:!1})}
function PageController(a,b,c){this.page=1*a||1;this.rtl=c||!1;this._listeners=[];var d=this;this.hashChangeHandler=function(){var a=1*/.*#(.*)/.exec(window.location.hash||"#1")[1];a>publicationData.pageUserCount&&(a=publicationData.pageUserCount);this.page!=pageTable.getFileIDFromUserID(a)&&(this.changePage(pageTable.getFileIDFromUserID(a)),e());for(var b=0,c=d._listeners.length;b<c;b++)d._listeners[b].call(d,pageTable.getFileIDFromUserID(a))};Modernizr.hashchange&&window.addEventListener("hashchange",
function(){d.hashChangeHandler()});var e=function(a){"undefined"==typeof a||2!=a.data.type&&2!=a.data||d.changePage(d.page);d.changeHash(d.page)};customEvents.addListener(CHANGE_BOOK_TYPE,function(a){e(a)});customEvents.addListener(ROTATE_DEVICE,function(a){e(a)});this.changePage(this.page);e()}
PageController.prototype={changePage:function(a){0>=a&&(a=1);a>publicationData.pageCount&&(a=publicationData.pageCount);var b=fbUtils.findArr(pageTable.doubleFlipList,a);"undefined"==typeof b&&(publicationData.rtlMode?0===a%2?b=fbUtils.findArr(pageTable.doubleFlipList,a-1):0!=a%2&&(b=fbUtils.findArr(pageTable.doubleFlipList,a+1)):0===a%2?b=fbUtils.findArr(pageTable.doubleFlipList,a+1):0!=a%2&&(b=fbUtils.findArr(pageTable.doubleFlipList,a-1)));a==publicationData.pageCount&&(b=1*pageTable.doubleFlipList.length-
1);0>=a&&(b=0);this.dubleCounter=b;this.page=a},changeHash:function(a){2==orientationObserver.typeBook&&!orientationObserver.zoom&&publicationData.page[a].stub&&(this.isLast()||(a-=1),this.dubleCounter=fbUtils.findArr(pageTable.doubleFlipList,a));if(0<a&&a<=publicationData.pageCount){if(!PUBL&&GAEnable){var b=window.location.pathname.split("/");_trackPageview(b[b.length-4]+"-"+pageTable.getUserIDFromFileID(a))}window.location.hash="#"+pageTable.getUserIDFromFileID(a)}},addListener:function(a,b){b?
this._listeners.unshift(a):this._listeners.push(a)},fire:function(){this.page=1>this.page?1:this.page;this.page=this.page>publicationData.pageCount?publicationData.pageCount:this.page;this.changeHash(this.page);Modernizr.hashchange||this.hashChangeHandler()},removeListener:function(a){for(i in this._listeners)this._listeners[i].toString()==a.toString()&&this._listeners.splice(i,1)},right:function(){if(2!=orientationObserver.typeBook||orientationObserver.zoom){if(this.rtl&&1>1*this.page-1||!this.rtl&&
1*this.page+1>publicationData.pageCount)return!1;this.page=this.rtl?1*this.page-1:1*this.page+1}else{this.dubleCounter<=pageTable.doubleFlipList.length-1&&(this.dubleCounter=this.rtl?1*this.dubleCounter-1:1*this.dubleCounter+1,0>this.dubleCounter&&(this.dubleCounter=0),this.dubleCounter>=pageTable.doubleFlipList.length&&(this.dubleCounter=pageTable.doubleFlipList.length-1));var a=this.dubleCounter;if(this.page==pageTable.doubleFlipList[a]&&!this.rtl||this.rtl&&1>1*this.page-1)return!1;this.page=pageTable.doubleFlipList[a]}this.fire()},
left:function(){if(2!=orientationObserver.typeBook||orientationObserver.zoom){if(!this.rtl&&1>1*this.page-1||this.rtl&&1*this.page+1>publicationData.pageCount)return!1;this.page=this.rtl?1*this.page+1:1*this.page-1}else{0<=this.dubleCounter&&(this.dubleCounter=this.rtl?1*this.dubleCounter+1:1*this.dubleCounter-1,0>this.dubleCounter&&(this.dubleCounter=0),this.dubleCounter>=pageTable.doubleFlipList.length&&(this.dubleCounter=pageTable.doubleFlipList.length-1));var a=this.dubleCounter;if(this.page==
pageTable.doubleFlipList[a]||!this.rtl&&1>1*this.page-1)return!1;this.page=pageTable.doubleFlipList[a]}this.fire()},goToPage:function(a){this.changePage(a);this.fire()},maxLeft:function(){this.page=this.rtl?publicationData.pageCount:1;this.fire()},maxRight:function(){this.page=this.rtl?1:publicationData.pageCount;this.fire()},isLast:function(){return 2!=orientationObserver.typeBook||orientationObserver.zoom?this.page===publicationData.pageCount?!0:!1:1*this.dubleCounter===1*pageTable.doubleFlipList.length-
1?!0:!1}};var PagerLite=function(a){this.div=a.pagerDiv;this.currentPageDiv=a.currentPageDiv;this.lastPageDiv=a.lastPageDiv;this.currentPageDiv.innerHTML=pageTable.getCaption(pageMediator.page);this.lastPageDiv.innerHTML=" / "+publicationData.pageUserCount;var b=this;pageMediator.addListener(function(a){b.changeLabel(a)});!0==a.connectSlider&&customEvents.addListener(SLIDER_TO_PAGER_CHANGE_LABEL,function(a){b.changeLabel(a.data.page)})};
PagerLite.prototype.changeLabel=function(a){this.currentPageDiv.firstChild.data=pageTable.getCaption(a)};
PagerLite.create=function(a){var b=workspace.createElement({id:a.parent.id+"PagerField",cssClassName:"pagerField",parent:a.parent,insertBefore:a.insertBefore}),c=workspace.createElement({id:a.parent.id+"PagerCurrentPage",cssClassName:"pagerFont",parent:b}),d=workspace.createElement({id:a.parent.id+"PagerLastPage",cssClassName:"pagerFont",parent:b});return new PagerLite({pagerDiv:b,currentPageDiv:c,lastPageDiv:d,connectSlider:a.connectSlider})};
function PageTable(){var a=0;this.captionToID=[];this.IDToDoubleCaption=[];this.IDToCaption=[];this.userIDToFileID=[];this.fileIDTouserID=[];this.doubleFlipList=[];publicationData.pageUserCount=publicationData.pageCount;var b=1,c=1;for(page in publicationData.page)if("defaults"!=page){var d=1*page+a;publicationData.page[page].wide&&(this.userIDToFileID[1*page+a]=1*page,this.fileIDTouserID[1*page+a]=1*page,a++,d=1*page+a-1+"-"+(1*page+a));this.userIDToFileID[1*page+a]=1*page;this.fileIDTouserID[1*
page]=1*page+a;this.captionToID[d]=1*page;this.IDToCaption[page]="one"!=publicationData.wideas?d:page;1==page?(this.IDToDoubleCaption[1]=1,this.doubleFlipList.push(1*page)):1==b?(c++,d=c,publicationData.page[page].wide?"one"!=publicationData.wideas&&(c++,d=d+"-"+c):(c++,d=d+"-"+c),this.IDToDoubleCaption[page]=d,publicationData.page[page].wide?b=1:b++,this.doubleFlipList.push(1*page)):(this.IDToDoubleCaption[page]=this.IDToDoubleCaption[page-1],b=1)}"one"!=publicationData.wideas&&(publicationData.pageUserCount+=
a);1!=this.IDToDoubleCaption[publicationData.pageCount]&&1*this.IDToDoubleCaption[publicationData.pageCount].split("-")[1]>publicationData.pageUserCount&&(this.IDToDoubleCaption[publicationData.pageCount]=this.IDToDoubleCaption[publicationData.pageCount].split("-")[0]);this.getCaption=function(a){if(orientationObserver.zoom||1===orientationObserver.getType())return publicationData.rtlMode?(this.IDToCaption[a]+"").split("-").reverse().join("-"):this.IDToCaption[a];if(2===orientationObserver.getType())return publicationData.rtlMode?
(this.IDToDoubleCaption[a]+"").split("-").reverse().join("-"):this.IDToDoubleCaption[a]};this.getFileID=function(a){return this.captionToID[a]};this.getFileIDFromUserID=function(a){a=(a+"").split("-")[0];return this.userIDToFileID[a]};this.getUserIDFromFileID=function(a){return this.fileIDTouserID[a]}}function SearchResult(a,b,c,d,e,f){this.id=pageTable.getCaption(a);search.pages[a]=!0;this.realID=a;this.text=b;this.relevant=c;this.startPos=d;this.stopPos=e;this.fullText=f}
var search={active:!1,result:[],pages:{},query:"",maxTextResultLength:90,getBold:function(a,b){return a.replace(RegExp(b,"ig"),function(a){return"<b>"+a+"</b>"})},buildSearchText:function(a,b,c){c=c||[];b-=this.maxTextResultLength/2;a=a.substr(0>b?0:b,1*this.maxTextResultLength+6);a=fbUtils.screening("..."+a+"...");if(0<c.length)for(b=0;b<c.length;b++)a=search.getBold(a,c[b]);else a=search.getBold(a,search.query);return a},buildIndexes:function(a,b,c){for(var d=[],e=0;e<b;e++){for(var f=[],k=a[e],
h=-publicationData.search.lim;-1!=h;)h=c.indexOf(k,h+publicationData.search.lim),-1!=h&&f.push(h);0<f.length&&d.push(f)}return d},searchFullCoincidence:function(a,b,c,d){for(var e=-1,f=-1,k=b.toLowerCase();0<=(e=k.indexOf(a,e+1));)if(f=e,!(0<e&&e<k.length-1)||fbUtils.isSplitter(k.charAt(e-1))&&fbUtils.isSplitter(k.charAt(e+a.length)))return this.result.push(new SearchResult(c,this.buildSearchText(b,e,[a]),d?0:1,e,e+a.length,d)),!0;if(0<=f&&!publicationData.search.exactMatch)return this.result.push(new SearchResult(c,
this.buildSearchText(b,f,[a]),d?2:3,f,f+a.length,d)),!0;delete null;return!1},searchPartiallyCoincidence:function(a,b,c,d,e){e=b.toLowerCase();e=this.buildIndexes(a,d,e);if(null==e||0==e.length)return!1;for(var f=0,k=Array(e.length),h=0;h<e.length;h++)k[h]=e[h][0];for(h=0;h<e.length-1;h++){var m=1E3,q=e[h],r=e[h+1];if(null==q||null==r)break;for(var n=q.length,l=r.length,t=0;t<n;t++)for(var p=0;p<l;p++){var v=q[t],s=r[p],u=(s>v?s-v:v-s)*(s>v?1:2);u<m&&(k[h]=v,k[h+1]=s,m=u)}f+=m}h=1E4;for(q=m=0;null!=
k&&q<k.length;q++)h=Math.min(h,k[q]),m=Math.max(m,k[q]);f+=1E3*(d-e.length);delete null;this.result.push(new SearchResult(c,this.buildSearchText(b,h,a),f+4,h,m,!1))},search:function(a,b){this.active&&search.stop();this.result=[];this.query=a=a.toLowerCase();var c=fbUtils.split(a,publicationData.search.lim);queryArrayLength=c.length;for(page in b.page)page=b.page[page],null==page["#text"]||search.searchFullCoincidence(a,page["#text"],page["@ID"],!0)||publicationData.search.exactMatch||(1<queryArrayLength?
this.searchPartiallyCoincidence(c,page["#text"],page["@ID"],queryArrayLength,a.length):1===queryArrayLength&&this.searchFullCoincidence(c[0],page["#text"],page["@ID"],!1));this.result.sort(this.sortFunc);search.active=!0;c={name:"searchTest",children:{}};for(i in search.result){var d=search.result[i];c.children[i]={};c.children[i].name=d.text;c.children[i].page=d.id;c.children[i].realID=d.realID}customEvents.fireEvent(SHOW_SEARCH_RESULTS,{data:c})},sortFunc:function(a,b){return a.relevant<b.relevant?
-1:a.relevant>b.relevant?1:a.id<b.id?-1:a.id>b.id?1:0},clear:function(){this.query=""},stop:function(){this.active=!1;this.query="";search.result=[]}};timer={state:!0,blockTime:0,endFX:0,startTime:Date.now(),setBlockTime:function(a,b){this.endFX=b||a;this.blockTime=a;this.startTime=Date.now()},check:function(a){a=a||"standart";if("standart"==a)return Date.now()-this.startTime>this.blockTime?!0:!1;if("high"==a)return!0;if("fx"==a)return Date.now()-this.startTime>this.endFX?!0:!1}};
var Toolbar=function(a){this.isVisible=!1;this.div=el.id(a.divID);this.isActive="undefined"!=typeof a.isActive?a.isActive:!1;setClickEvents(this.div,"dp")};Toolbar.prototype.show=function(){workspace.delCssClass(this.div,"hidden");this.isVisible=!0};Toolbar.prototype.hide=function(){workspace.addCssClass(this.div,"hidden");with(workspace.pager)isEdit&&hideInputField();this.isVisible=!1};
Toolbar.prototype.toggle=function(){workspace.changeCssClass(this.div,"hidden");with(workspace.pager)isEdit&&hideInputField();this.isVisible=!this.isVisible};
Toolbar.create=function(a){var b=workspace.createElement({type:"aside",id:a.divID,cssClassName:"toolbar",parent:el.id("body")});"top"!=a.position&&"bottom"!=a.position||workspace.addCssClass(b,"horizontalToolbar");"left"!=a.position&&"right"!=a.position||workspace.addCssClass(b,"verticalToolbar");workspace.addCssClass(b,a.position+"Toolbar "+a.divID+" hidden");return new Toolbar({divID:a.divID,isActive:a.isActive})};
var video={getVideoImageUrl:function(a){return COMMON_FOLDER+"/pages-content/"+a},inject:function(a,b){var c=a.getContext("2d");c.fillStyle="rgba(0,0,0,1)";var d=a.width/(publicationData.page[b].width||publicationData.page.defaults.width),e=function(a){with(publicationData.page[b].videos[a])var k=(width*d).toFixed(0),h=(height*d).toFixed(0),m=x*d,q=y*d,r=video.getVideoImageUrl(imageUri),n=showImage;n&&c.fillRect(m,q,k,h);var l=new Image;changeUrlWhenPubl(r,function(a){l.src=a});l.onload=function(){var d=
new Image,p=50<h?50:0.8*h;d.src=video.getPlayImage();d.onload=function(){if(n){var r=(l.width/l.height).toFixed(1),s=(k/h).toFixed(1);if(r<=s)r=Math.abs((l.height-l.width/s)/2),s=l.height-2*r,c.drawImage(l,0,r,l.width,s,m,q,k,h),delete null,delete null;else{var u=Math.abs((l.height/s-l.width)/2),w=l.width-2*u;c.drawImage(l,u,0,w,l.height,m,q,k,h);u=null;delete u;w=null;delete w}delete u;delete w}c.drawImage(d,m+(k/2-p/2),q+(h/2-p/2),p,p);a<publicationData.page[b].videos.length-1&&e(a+1)}}};e(0)},
getPlayImage:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABDCAYAAAAoCNNNAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RENDMjEyQkZENEQwMTFFMDg0N0M5RkRBMUU2NDQ2RUIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RENDMjEyQzBENEQwMTFFMDg0N0M5RkRBMUU2NDQ2RUIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpEQ0MyMTJCREQ0RDAxMUUwODQ3QzlGREExRTY0NDZFQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpEQ0MyMTJCRUQ0RDAxMUUwODQ3QzlGREExRTY0NDZFQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PktdS6EAAA9LSURBVHja1FsJUFRX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"},
play:function(a,b,c,d){var e=el.add("div");e.id="videoDiv";e.style.width="100%";e.style.height="100%";e.style.position="absolute";e.style.top="0px";e.style.display="block";e.style.zIndex="1000000";e.style.webkitTransform="translate3d(0px,0px,300px)";e.style.backgroundColor="rgba(0,0,0,0.7)";el.id("body").appendChild(e);setClickEvents(e,!1);e.addEventListener(SINGLE_CLICK,function(a){c&&c();el.del("videoDiv");customEvents.removeListener(ROTATE_DEVICE,k);a.preventDefault();a.stopPropagation()});var f=
el.add("div");f.id="videoPlayer";f.style.position="relative";f.style.marginLeft="auto";f.style.marginRight="auto";f.style.top="50%";f.style.backgroundColor="rgba(0,0,0,1)";e.appendChild(f);d=el.add("iframe");f.appendChild(d);d.className="youtube-player";d.type="text/html";d.width="100%";d.height="100%";d.frameBorder="0";d.style.display="inline-block";"youtube"==a?(d.className="youtube-player",d.src="http://www.youtube.com/embed/"+b+"?autoplay=1&html5=1"):"vimeo"==a&&(d.src="http://player.vimeo.com/video/"+
b+"?title=0&amp;byline=0&amp;portrait=0&amp;color=da4541");var k=function(){workspace.handleResize();window.setTimeout(function(){var a=e.offsetWidth-50;640<a&&(a=640);var b=a/1.64;b>0.9*(e.offsetHeight-50)&&(b=0.9*(e.offsetHeight-50),a=1.64*b);f.style.width=a+"px";f.style.height=b+"px";f.style.marginTop=-(b/2)+"px"},system.platform.android?600:0)};k();customEvents.addListener(ROTATE_DEVICE,k)}};
